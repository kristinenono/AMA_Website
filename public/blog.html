<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Single Page Layout</title>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/bcae03608a.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
  </head>
  <body>
    <main>
      <div class="blogpage">
        <div id="blogSection" class="blogSection-box">
          <h2 class="primaryheader">Blog</h2>
          <p class="primaryBody">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum at
            magni porro voluptatibus, quasi doloribus provident officiis, illo
            hic laborum distinctio mollitia quis minima ducimus.
          </p>
          <button id="addPostButton" class="addPostBtn">Add a post</button>
        </div>

        <div id="addPostForm" class="modal">
          <div class="modal-background"></div>
          <div class="modal-content">
            <div class="box">
              <h1
                id="addPostTitle"
                class="card-header-title is-centered is-large is-size-4"
              >
                Add a Blog Post
              </h1>
              <div class="field">
                <label class="label">Title</label>
                <div class="control">
                  <input class="input" type="text" id="title" />
                </div>
              </div>
              <div class="field">
                <label class="label">Message</label>
                <div class="control">
                  <textarea class="textarea" id="message"></textarea>
                </div>
              </div>
              <div class="field">
                <label class="label">Author</label>
                <div class="control">
                  <input class="input" type="text" id="author" />
                </div>
              </div>
              <div class="field">
                <label class="label">Date</label>
                <div class="control">
                  <input class="input" type="date" id="date" />
                </div>
              </div>
              <button id="submitPost" class="button">Submit</button>
            </div>
          </div>
          <button class="modal-close is-large" aria-label="close"></button>
        </div>

        <!-- all posts from the database -->
        <div
          id="all_posts"
          class="has-background-lightgray p-4 m-3 has-background-grey-lighter"
        >
          <h1 class="title">All posts</h1>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-box">
        <div class="footer-section">
          <div class="navbar-items">
            <img src="images/AMA_Logo_Footer.png" alt="" id="img_logo" />
            <div id="uw-wisc">
              <strong id="footer-uw-logo" class="text-logo"
                >University of Wisconsin Madison</strong
              >
            </div>
          </div>
          <div class="social-icons" id="icons">
            <a
              href="https://www.linkedin.com/in/ama-badgers-5247a9252/"
              id="social-icon"
            >
              <i class="fab fa-linkedin fa-2x"></i>
            </a>
            <a href="https://www.instagram.com/amabadgers/" id="social-icon">
              <i class="fab fa-instagram fa-2x"></i>
            </a>
            <a href="https://www.facebook.com/AMAUWMadison/" id="social-icon">
              <i class="fab fa-facebook fa-2x"></i>
            </a>
            <a href="https://twitter.com/amauwmadison?lang=en">
              <i class="fab fa-twitter fa-2x"></i>
            </a>
          </div>
          <div id="adress">
            <p>975 University Ave, Madison, WI 53706</p>
            <p id="phone">+00 000 000 000</p>
          </div>
        </div>
        <div class="footer-section" id="footer-link-padding">
          <div>
            <div id="footer-padding">
              <a href="#"><b>About Us</b></a>
            </div>
            <div id="footer-padding">
              <a href="#"><b>Blog</b></a>
            </div>
            <div id="footer-padding">
              <a href="#"><b>Point System</b></a>
            </div>
            <div id="footer-padding">
              <a href="#"><b>Contact Us</b></a>
            </div>
            <div id="footer-padding">
              <a href="calendar.html"><b>Events</b></a>
            </div>
            <div id="footer-padding">
              <a href="#"><b>Become a Sponsor</b></a>
            </div>
          </div>
        </div>
        <div id="line"></div>
        <div class="footer-section">
          <h2>JOIN OUR EMAIL LIST</h2>
          <p>
            Want to become an official member of the Badger American Marketing
            Association or just be added to the email list? Fill out our member
            form to stay up to date on upcoming events!
          </p>
          <input type="text" placeholder="Enter your email here" />
          <button id="submit_btn">
            <p>SUBMIT</p>
          </button>
        </div>
      </div>
    </footer>
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>

    <script>
      // TODO
      // Copy **only** your firebaseConfig from Google Firebae and add it below

      // Your web app's Firebase configuration

      const firebaseConfig = {
        apiKey: "AIzaSyBEZAtfgyF88HPoBR94OxTJe0Io7lyKbjA",
        authDomain: "amabadgers.firebaseapp.com",
        projectId: "amabadgers",
        storageBucket: "amabadgers.appspot.com",
        messagingSenderId: "131147849099",
        appId: "1:131147849099:web:a969b845dd736bbc2de38e",
        measurementId: "G-907H1EJYVP",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      // define authentication variable
      let auth = firebase.auth();
      let db = firebase.firestore();

      // define a storage reference
      let ref = firebase.storage().ref();
    </script>
    <!-- make sure to add your own js file as the last line in index.html file -->
    <script>
      // Get the modal
      var modal = document.getElementById("addPostForm");

      // Get the button that opens the modal
      var btn = document.getElementById("addPostButton");

      // Get the <span> element that closes the modal
      var span = modal.querySelector(".modal-close");

      // When the user clicks the button, open the modal
      btn.onclick = function () {
        modal.classList.add("is-active");
      };

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.classList.remove("is-active");
      };

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.classList.remove("is-active");
        }
      };

      // Handle form submission
      document.querySelector("#submitPost").addEventListener("click", () => {
        // construct the post object
        let post = {
          title: document.querySelector("#title").value,
          message: document.querySelector("#message").value,
          author: document.querySelector("#author").value,
          date: document.querySelector("#date").value,
        };

        // store the post object into the Firestore collection "allPosts"
        db.collection("allPosts")
          .add(post)
          .then(() => {
            alert("Post added");
            modal.classList.remove("is-active"); // Hide the modal after successful submission
          })
          .catch((error) => {
            console.error("Error adding post: ", error);
          });
      });

      // Function to show all posts
      function show_posts() {
        db.collection("allPosts")
          .get()
          .then((querySnapshot) => {
            let html = "";
            querySnapshot.forEach((doc) => {
              const post = doc.data();
              const postId = doc.id;
              html += `
                      <div class="container my-4">
                        <div class="card" id="${postId}">
                          <header class="card-header">
                            <p class="card-header-title">${post.title}</p>
                          </header>
                          <div class="card-content">
                            <div class="content">
                              ${post.message}
                              <br><br>
                              <p class="card-header-subtitle"><span style="font-size: smaller; font-weight: bold;">By: ${post.author} // <time datetime="${post.date}">${post.date}</time></span></p>
                            </div>
                          </div>
                          <footer class="card-footer">
                            <a href="#" class="card-footer-item" onclick="editPost('${postId}')">Edit</a>
                            <a href="#" class="card-footer-item" onclick="deletePost('${postId}')">Delete</a>
                          </footer>
                        </div>
                      </div>`;
            });
            document.querySelector("#all_posts").innerHTML = html;
          })
          .catch((error) => {
            console.error("Error getting posts: ", error);
          });
      }

      // Function to delete a post
      function deletePost(postId) {
        if (confirm("Are you sure you want to delete this post?")) {
          db.collection("allPosts")
            .doc(postId)
            .delete()
            .then(() => {
              console.log("Post successfully deleted!");
              show_posts();
            })
            .catch((error) => {
              console.error("Error removing post: ", error);
            });
        }
      }

      // Function to edit a post
      function editPost(postId) {
        // Retrieve the post data from Firestore using the postId
        db.collection("allPosts")
          .doc(postId)
          .get()
          .then((doc) => {
            if (doc.exists) {
              const post = doc.data();
              // Populate the form fields with the retrieved post data
              document.querySelector("#title").value = post.title;
              document.querySelector("#message").value = post.message;
              document.querySelector("#author").value = post.author;
              document.querySelector("#date").value = post.date;

              // Display a form with input fields for editing
              const editForm = `
              <div class="box">
                <h2 class="card-header-title is-centered is-2 mt-0" style="font-size: larger;">Edit Post</h2>
  <div class="field">
    <label class="label">Title</label>
    <div class="control">
      <input class="input" type="text" id="edit_title" value="${post.title}" />
    </div>
  </div>
  <div class="field">
    <label class="label">Message</label>
    <div class="control">
      <textarea class="textarea" type="text" id="edit_message" value="${post.message}"></textarea>

    </div>
  </div>
  <div class="field">
    <label class="label">Author</label>
    <div class="control">
      <input class="input" type="text" id="edit_author" value="${post.author}" />
  </div>
  <div class="field">
    <label class="label">Date</label>
    <div class="control">
      <input class="input" type="date" id="edit_date" value="${post.date}" />
    </div>
  </div>
  <div class="field is-grouped">
    <div class="control">
      <button class="addPostBtn" onclick="saveEdit('${postId}')">Save</button>
    </div>
  </div>
</div>

            `;
              document.querySelector(`#${postId}`).innerHTML = editForm;
            } else {
              console.log("No such document!");
            }
          })
          .catch((error) => {
            console.error("Error getting document:", error);
          });
      }

      // Function to save edited post
      function saveEdit(postId) {
        const editedPost = {
          title: document.querySelector("#edit_title").value,
          message: document.querySelector("#edit_message").value,
          author: document.querySelector("#edit_author").value,
          date: document.querySelector("#edit_date").value,
        };

        // Update the post in Firestore
        db.collection("allPosts")
          .doc(postId)
          .update(editedPost)
          .then(() => {
            console.log("Post successfully updated!");
            // Reload the posts after updating
            show_posts();
          })
          .catch((error) => {
            console.error("Error updating post:", error);
          });
      }

      // Call the function to display existing posts when the page loads
      show_posts();
    </script>
    <script src="app.js"></script>
  </body>
</html>
